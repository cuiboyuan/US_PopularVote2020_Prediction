state=="ND"~ "north dakota",
state=="OH"~ "ohio",
state=="OK"~ "oklahoma",
state=="OR"~ "oregon",
state=="PA"~ "pennsylvania",
state=="RI"~ "rhode island",
state=="SC"~ "south carolina",
state=="SD"~ "south dakota",
state=="TN"~ "tennessee",
state=="TX"~ "texas ",
state=="UT"~ "utah ",
state=="VT"~ "vermont",
state=="VA"~ "virginia",
state=="WA"~ "washington",
state=="WV"~ "west virginia",
state=="WI"~ "wisconsin",
state=="WY"~ "wyoming",
state=="DC" ~"district of columbia")
reduced_data$state <- states
attach(reduced_data)
race <- case_when(race_ethnicity=="White"~"white",
race_ethnicity=="Black, or African American"~"black/african american/negro",
race_ethnicity=="American Indian or Alaska Native"~"american indian or alaska native",
race_ethnicity=="Asian (Chinese)"~"chinese",
race_ethnicity=="Asian (Japanese)"~"japanese",
race_ethnicity=="Asian (Asian Indian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Filipino)"~"other asian or pacific islander",
race_ethnicity=="Asian (Korean)"~"other asian or pacific islander",
race_ethnicity=="Asian (Vietnamese)"~"other asian or pacific islander",
race_ethnicity=="Asian (Other)"~"other asian or pacific islander",
race_ethnicity=="Asian (Native Hawaiian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Guamanian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Samoan)"~"other asian or pacific islander",
race_ethnicity=="Asian (Other)"~"other asian or pacific islander",
race_ethnicity=="Some other race"~"other race, nec"
)
reduced_data$race_ethnicity <- race
edu_lvl <- case_when(education=="3rd Grade or less"~0,
education=="Middle School - Grades 4 - 8"~1,
education=="Completed some high school "~2,
education=="High school graduate"~3,
education=="Other post high school vocational training"~4,
education=="Completed some college, but no degree"~5,
education=="Associate Degree"~6,
education=="College Degree (such as B.A., B.S.)"~7,
education=="Completed some graduate, but no degree"~8,
education=="Masters degree"~9,
education=="Doctorate degree"~10
)
reduced_data <- reduced_data %>% mutate(edu_level=edu_lvl)
employ <- case_when(employment=="Full-time employed"~"employed",
employment=="Homemaker"~"not in labor force",
employment=="Retired"~"not in labor force",
employment=="Unemployed or temporarily on layoff"~"unemployed",
employment=="Part-time employed"~"employed",
employment=="Permanently disabled"~"not in labor force",
employment=="Student"~"not in labor force",
employment=="Self-employed"~"employed",
employment=="Other"~"not in labor force",
)
reduced_data$employment <- employ
inc_lvl <- as.numeric(household_income)-1
reduced_data <- reduced_data %>% mutate(income_level=inc_lvl)
detach(reduced_data)
View(reduced_data)
reduced_data$state
is.na(reduced_data$state)
is.na(reduced_data$state) %>% sum()
library(haven)
library(tidyverse)
# Read in the raw data (You might need to change this if you use a different dataset)
raw_data <- read_dta("inputs/survey_data/ns20200625.dta")
# Add the labels
raw_data <- labelled::to_factor(raw_data)
# Just keep some variables
reduced_data <-
raw_data %>%
select(interest,
registration,
vote_2016,
vote_intention,
vote_2020,
ideo5,
employment,
foreign_born,
gender,
census_region,
hispanic,
race_ethnicity,
household_income,
education,
state,
congress_district,
age)
#### What else???? ####
# Maybe make some age-groups?
# Maybe check the values?
# Is vote a binary? If not, what are you going to do?
reduced_data <- reduced_data %>% na.omit()
reduced_data<-
reduced_data %>%
mutate(vote_trump =
ifelse(vote_2020=="Donald Trump", 1, 0))
reduced_data<-
reduced_data %>%
mutate(vote_biden =
ifelse(vote_2020=="Joe Biden", 1, 0))
# States name
attach(reduced_data)
states = case_when(state=="AL"~ "alabama",
state=="AK"~ "alaska",
state=="AZ"~ "arizona",
state=="AR"~ "arkansas",
state=="CA"~ "california",
state=="CO"~ "colorado",
state=="CT"~ "connecticut",
state=="DE"~ "delaware",
state=="FL"~ "florida",
state=="GA"~ "georgia",
state=="HI"~ "hawaii",
state=="ID"~ "idaho",
state=="IL"~ "illinois",
state=="IN"~ "indiana",
state=="IA"~ "iowa",
state=="KS"~ "kansas",
state=="KY"~ "kentucky",
state=="LA"~ "louisiana",
state=="ME"~ "maine",
state=="MD"~ "maryland",
state=="MA"~ "massachusetts",
state=="MI"~ "michigan",
state=="MN"~ "minnesota",
state=="MS"~ "mississippi",
state=="MO"~ "missouri",
state=="MT"~ "montana",
state=="NE"~ "nebraska",
state=="NV"~ "nevada",
state=="NH"~ "new hampshire",
state=="NJ"~ "new jersey",
state=="NM"~ "new mexico",
state=="NY"~ "new york",
state=="NC"~ "north carolina",
state=="ND"~ "north dakota",
state=="OH"~ "ohio",
state=="OK"~ "oklahoma",
state=="OR"~ "oregon",
state=="PA"~ "pennsylvania",
state=="RI"~ "rhode island",
state=="SC"~ "south carolina",
state=="SD"~ "south dakota",
state=="TN"~ "tennessee",
state=="TX"~ "texas",
state=="UT"~ "utah",
state=="VT"~ "vermont",
state=="VA"~ "virginia",
state=="WA"~ "washington",
state=="WV"~ "west virginia",
state=="WI"~ "wisconsin",
#state=="WY"~ "wyoming",
state=="DC" ~"district of columbia")
reduced_data$state <- states
attach(reduced_data)
race <- case_when(race_ethnicity=="White"~"white",
race_ethnicity=="Black, or African American"~"black/african american/negro",
race_ethnicity=="American Indian or Alaska Native"~"american indian or alaska native",
race_ethnicity=="Asian (Chinese)"~"chinese",
race_ethnicity=="Asian (Japanese)"~"japanese",
race_ethnicity=="Asian (Asian Indian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Filipino)"~"other asian or pacific islander",
race_ethnicity=="Asian (Korean)"~"other asian or pacific islander",
race_ethnicity=="Asian (Vietnamese)"~"other asian or pacific islander",
race_ethnicity=="Asian (Other)"~"other asian or pacific islander",
race_ethnicity=="Asian (Native Hawaiian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Guamanian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Samoan)"~"other asian or pacific islander",
race_ethnicity=="Asian (Other)"~"other asian or pacific islander",
race_ethnicity=="Some other race"~"other race, nec"
)
reduced_data$race_ethnicity <- race
edu_lvl <- case_when(education=="3rd Grade or less"~0,
education=="Middle School - Grades 4 - 8"~1,
education=="Completed some high school "~2,
education=="High school graduate"~3,
education=="Other post high school vocational training"~4,
education=="Completed some college, but no degree"~5,
education=="Associate Degree"~6,
education=="College Degree (such as B.A., B.S.)"~7,
education=="Completed some graduate, but no degree"~8,
education=="Masters degree"~9,
education=="Doctorate degree"~10
)
reduced_data <- reduced_data %>% mutate(education_level=edu_lvl)
employ <- case_when(employment=="Full-time employed"~"employed",
employment=="Homemaker"~"not in labor force",
employment=="Retired"~"not in labor force",
employment=="Unemployed or temporarily on layoff"~"unemployed",
employment=="Part-time employed"~"employed",
employment=="Permanently disabled"~"not in labor force",
employment=="Student"~"not in labor force",
employment=="Self-employed"~"employed",
employment=="Other"~"not in labor force",
)
reduced_data$employment <- employ
inc_lvl <- as.numeric(household_income)-1
reduced_data <- reduced_data %>% mutate(income_level=inc_lvl)
detach(reduced_data)
is.na(reduced_data$state)
is.na(reduced_data$state) %>% sum()
reduced_data <- reduced_data %>% rename(race=race_ethnicity)
View(reduced_data)
#### Preamble ####
# Purpose: Prepare and clean the survey data downloaded from https://www.voterstudygroup.org/publication/nationscape-data-set
# Author: Boyuan Cui, Zhaocheng Li
# Data: October 31, 2020
# Contact:
# License: MIT
# Pre-requisites:
# - Need to have downloaded the data from VoterStudyGroup and save to the folder inputs/data
#### Workspace setup ####
library(haven)
library(tidyverse)
# Read in the raw data (You might need to change this if you use a different dataset)
raw_data <- read_dta("inputs/survey_data/ns20200625.dta")
# Add the labels
raw_data <- labelled::to_factor(raw_data)
# Just keep some variables
reduced_data <-
raw_data %>%
select(interest,
registration,
vote_2016,
vote_intention,
vote_2020,
ideo5,
employment,
foreign_born,
gender,
census_region,
hispanic,
race_ethnicity,
household_income,
education,
state,
congress_district,
age)
#### What else???? ####
# Maybe make some age-groups?
# Maybe check the values?
# Is vote a binary? If not, what are you going to do?
reduced_data <- reduced_data %>% na.omit()
reduced_data<-
reduced_data %>%
mutate(vote_trump =
ifelse(vote_2020=="Donald Trump", 1, 0))
reduced_data<-
reduced_data %>%
mutate(vote_biden =
ifelse(vote_2020=="Joe Biden", 1, 0))
# States name
attach(reduced_data)
states = case_when(state=="AL"~ "alabama",
state=="AK"~ "alaska",
state=="AZ"~ "arizona",
state=="AR"~ "arkansas",
state=="CA"~ "california",
state=="CO"~ "colorado",
state=="CT"~ "connecticut",
state=="DE"~ "delaware",
state=="FL"~ "florida",
state=="GA"~ "georgia",
state=="HI"~ "hawaii",
state=="ID"~ "idaho",
state=="IL"~ "illinois",
state=="IN"~ "indiana",
state=="IA"~ "iowa",
state=="KS"~ "kansas",
state=="KY"~ "kentucky",
state=="LA"~ "louisiana",
state=="ME"~ "maine",
state=="MD"~ "maryland",
state=="MA"~ "massachusetts",
state=="MI"~ "michigan",
state=="MN"~ "minnesota",
state=="MS"~ "mississippi",
state=="MO"~ "missouri",
state=="MT"~ "montana",
state=="NE"~ "nebraska",
state=="NV"~ "nevada",
state=="NH"~ "new hampshire",
state=="NJ"~ "new jersey",
state=="NM"~ "new mexico",
state=="NY"~ "new york",
state=="NC"~ "north carolina",
state=="ND"~ "north dakota",
state=="OH"~ "ohio",
state=="OK"~ "oklahoma",
state=="OR"~ "oregon",
state=="PA"~ "pennsylvania",
state=="RI"~ "rhode island",
state=="SC"~ "south carolina",
state=="SD"~ "south dakota",
state=="TN"~ "tennessee",
state=="TX"~ "texas",
state=="UT"~ "utah",
state=="VT"~ "vermont",
state=="VA"~ "virginia",
state=="WA"~ "washington",
state=="WV"~ "west virginia",
state=="WI"~ "wisconsin",
state=="WY"~ "wyoming",
state=="DC" ~"district of columbia")
reduced_data$state <- states
attach(reduced_data)
race <- case_when(race_ethnicity=="White"~"white",
race_ethnicity=="Black, or African American"~"black/african american/negro",
race_ethnicity=="American Indian or Alaska Native"~"american indian or alaska native",
race_ethnicity=="Asian (Chinese)"~"chinese",
race_ethnicity=="Asian (Japanese)"~"japanese",
race_ethnicity=="Asian (Asian Indian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Filipino)"~"other asian or pacific islander",
race_ethnicity=="Asian (Korean)"~"other asian or pacific islander",
race_ethnicity=="Asian (Vietnamese)"~"other asian or pacific islander",
race_ethnicity=="Asian (Other)"~"other asian or pacific islander",
race_ethnicity=="Asian (Native Hawaiian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Guamanian)"~"other asian or pacific islander",
race_ethnicity=="Asian (Samoan)"~"other asian or pacific islander",
race_ethnicity=="Asian (Other)"~"other asian or pacific islander",
race_ethnicity=="Some other race"~"other race, nec"
)
reduced_data$race_ethnicity <- race
edu_lvl <- case_when(education=="3rd Grade or less"~0,
education=="Middle School - Grades 4 - 8"~1,
education=="Completed some high school "~2,
education=="High school graduate"~3,
education=="Other post high school vocational training"~4,
education=="Completed some college, but no degree"~5,
education=="Associate Degree"~6,
education=="College Degree (such as B.A., B.S.)"~7,
education=="Completed some graduate, but no degree"~8,
education=="Masters degree"~9,
education=="Doctorate degree"~10
)
reduced_data <- reduced_data %>% mutate(education_level=edu_lvl)
employ <- case_when(employment=="Full-time employed"~"employed",
employment=="Homemaker"~"not in labor force",
employment=="Retired"~"not in labor force",
employment=="Unemployed or temporarily on layoff"~"unemployed",
employment=="Part-time employed"~"employed",
employment=="Permanently disabled"~"not in labor force",
employment=="Student"~"not in labor force",
employment=="Self-employed"~"employed",
employment=="Other"~"not in labor force",
)
reduced_data$employment <- employ
inc_lvl <- as.numeric(household_income)-1
reduced_data <- reduced_data %>% mutate(income_level=inc_lvl)
reduced_data <- reduced_data %>% rename(race=race_ethnicity)
detach(reduced_data)
# Saving the survey/sample data as a csv file in my
# working directory
write_csv(reduced_data, "outputs/survey_data.csv")
#### Preamble ####
# Purpose: Prepare and clean the survey data downloaded from https://usa.ipums.org/usa/index.shtml
# Author: Boyuan Cui, Zhaocheng Li
# Data: October 31, 2020
# Contact:
# License: MIT
# Pre-requisites:
# - Need to have downloaded the IPUMS USA data and saved it to inputs/census_data
#### Workspace setup ####
library(haven)
library(tidyverse)
# Read in the raw data.
raw_data <- read_dta("inputs/census_data/usa_00001.dta.gz")
# Add the labels
raw_data <- labelled::to_factor(raw_data)
# Just keep some variables that may be of interest (change
# this depending on your interests)
reduced_data <-
raw_data %>%
select(#region,
statefip,
sex,
age,
race,
#hispan,
#marst,
#bpl,
#citizen,
educd,
educ,
inctot,
empstat
)
#labforce,
#labforce)
#### What's next? ####
## Here I am only splitting cells by age, but you
## can use other variables to split by changing
## count(age) to count(age, sex, ....)
reduced_data <- reduced_data %>% na.omit()
reduced_data <- reduced_data %>% filter(educd!="n/a" & empstat!="n/a")
reduced_data <-
reduced_data %>%
filter(age != "less than 1 year old") %>%
filter(age != "90 (90+ in 1980 and 1990)")
reduced_data$age <- as.integer(reduced_data$age)
attach(reduced_data)
edu_lvl <- as.numeric(educd) %>% as.integer()
edu_lvl <- replace(edu_lvl, edu_lvl>=43, 1000)
edu_lvl <- replace(edu_lvl, edu_lvl<=42 & edu_lvl>36, 900)
edu_lvl <- replace(edu_lvl, edu_lvl<=36 & edu_lvl>31, 700)
edu_lvl <- replace(edu_lvl, edu_lvl<=31 & edu_lvl>29, 600)
edu_lvl <- replace(edu_lvl, edu_lvl<=29 & edu_lvl>26, 500)
edu_lvl <- replace(edu_lvl, edu_lvl==26, 400)
edu_lvl <- replace(edu_lvl, edu_lvl<=25 & edu_lvl>23, 300)
edu_lvl <- replace(edu_lvl, edu_lvl<=23 & edu_lvl>18, 200)
edu_lvl <- replace(edu_lvl, edu_lvl<=18 & edu_lvl>10, 100)
edu_lvl <- replace(edu_lvl, edu_lvl<=10, 0)
edu_lvl <- edu_lvl/100
reduced_data <- reduced_data %>% mutate(education_level=edu_lvl)
inc_lvl <- case_when(inctot<15000~0,
inctot>=15000&inctot<20000~1,
inctot>=20000&inctot<25000~2,
inctot>=25000&inctot<30000~3,
inctot>=30000&inctot<35000~4,
inctot>=35000&inctot<40000~5,
inctot>=40000&inctot<45000~6,
inctot>=45000&inctot<50000~7,
inctot>=50000&inctot<55000~8,
inctot>=55000&inctot<60000~9,
inctot>=60000&inctot<65000~10,
inctot>=65000&inctot<70000~11,
inctot>=70000&inctot<75000~12,
inctot>=75000&inctot<80000~13,
inctot>=80000&inctot<85000~14,
inctot>=85000&inctot<90000~15,
inctot>=90000&inctot<95000~16,
inctot>=95000&inctot<100000~17,
inctot>=100000&inctot<125000~18,
inctot>=125000&inctot<150000~19,
inctot>=150000&inctot<175000~20,
inctot>=175000&inctot<200000~21,
inctot>=200000&inctot<250000~22,
inctot>=250000~23
)
reduced_data <- reduced_data %>% mutate(income_level=inc_lvl)
detach(reduced_data)
reduced_data <- reduced_data %>% rename(state=statefip, gender=sex)
reduced_data <- reduced_data %>%
count(age, gender, state, race, education_level, income_level) %>%
group_by(age, gender, state, race, education_level, income_level)
# Saving the census data as a csv file
write_csv(reduced_data, "outputs/census_data.csv")
library(tidyverse)
# Loading in the cleaned survey Data
survey_data <- read_csv("outputs/survey_data.csv")
# Loading in the cleaned census Data
census_data <- read_csv("outputs/census_data.csv")
# Creating the Model
model <- glm(vote_trump ~ age + gender + state + race + education_level + income_level,
data=survey_data, family= "binomial")
# Model Results (to Report in Results section)
# summary(model)
# OR
# broom::tidy(model)
# Model Results (to Report in Results section)
# summary(model)
# OR
broom::tidy(model)
# Creating the Model
model_trump <- glm(vote_trump ~ age + gender + state + race + education_level + income_level,
data=survey_data, family= "binomial")
# Model Results (to Report in Results section)
# summary(model)
# OR
broom::tidy(model_trump)
# Creating the Model
model_biden <- glm(vote_biden ~ age + gender + state + race + education_level + income_level,
data=survey_data, family= "binomial")
# Model Results (to Report in Results section)
# summary(model)
# OR
broom::tidy(model_biden)
# Model Results (to Report in Results section)
# summary(model)
# OR
broom::tidy(model_trump)
# Model Results (to Report in Results section)
# summary(model)
# OR
broom::tidy(model_biden)
# Creating the Model
model_trump <- glm(vote_trump ~ age + gender + state + race + education_level + income_level,
data=survey_data, family= "binomial")
# Model Results (to Report in Results section)
# summary(model)
# OR
# Creating the Model
model_biden <- glm(vote_biden ~ age + gender + state + race + education_level + income_level,
data=survey_data, family= "binomial")
# Model Results (to Report in Results section)
# summary(model)
# OR
broom::tidy(model_biden)
broom::tidy(model_trump)
# Model Results (to Report in Results section)
# summary(model)
# OR
broom::tidy(model_biden)
broom::tidy(model_trump)
model_biden
