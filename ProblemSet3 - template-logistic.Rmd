---
title: "Prediction Analysis on the U.S. 2020 Election Popular Vote"
author: "Boyuan Cui, Zhaocheng Li"
date: "November 2, 2020"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
library(tidyverse)

# Loading in the cleaned survey Data
survey_data <- read_csv("outputs/survey_data.csv")

# Loading in the cleaned census Data
census_data <- read_csv("outputs/census_data.csv")

```

# Abstract

__Key Words:__ U.S. 2020 Election, Popular Vote, Post-stratification, Logistic Regression

This report is an analysis to predict the outcome of U.S. 2020 federal election popular vote for Joe Biden and Donald Trump. The analysis employs the post-stratification technique by dividing the data into (number) cells according to variable age, and uses the logistic regression model to estimate the proportion of popular vote in each cell. The final result of popular vote proportion prediction is (result) for Biden and (result) for Trump.

# Introduction

The U.S. presidential election has always been a popular topic of the world for every four year, and as the election day for 2020 comes closer, we are all looking forward to see who will become the next U.S. president. This report is interested in predicting the U.S. 2020 election popular vote for each candidate (Joe Bide and Donald Trump).

We will use the post-stratification technique in our analysis.

# Data

We extract the survey data from Democracy Fund + UCLA Nationscape [1] and the census data from IPUMS USA [2]. We remove all the examples with NA data from these two datasets. 

The survey data is collected on June 25, 2020, and the census data is collected in 2018.

# Model

To perform a post-stratification analysis, we need several steps:

First, we need to determine which variables we will use to divide the census data into different cells. In this report, we will use variable (vars)

Then, we will fit a model using these variables, and we will apply this model to each cell to estimate the probability of voting for a candidate.

To finish up our post-stratification analysis, we will calculate the weighted mean $\hat{y}^{PS}$ of all cells with the formula below:

$$\hat{y}^{PS}=\frac{\sum_j N_j\cdot \hat{y_j} }{\sum_j N_j}$$
Where $N_j,\hat{y_j}$ are the total count and model estimate of each cell, respectively.

## Model Specifics

For our model, because each voter either votes or does not vote for one candidate, we are handling binary data. Thus, we will apply the logistic regression model.

To analyze the proportion of voters voting for Trump/Biden, we will incorporate variables (vars) to our model. To express the model mathematically, we have:

$$ \ln(\frac{p}{1-p}) = \beta_0+\beta_1  x_{age} + \epsilon$$

Where $p$ represents the proportion of voters who will vote for Trump/Biden, depending on which model we are using. Value of $\epsilon$ represents the residual of our fit. Parameter $\beta_0$ represents the intercept of the model, which indicates the value of logit function $\log(\frac{p}{1-p})$ when (...). 

Additionally, $\beta_1$ represents the slope of the model. So, for everyone one unit increase in age, we expect a $\beta_1$ increase in the probability of voting for Donald Trump.

We will fit two models with the above formula, one for Trump and one for Biden.

```{r, include=FALSE}
survey_data = within(survey_data, race <- relevel(as.factor(race), ref = 7)) # make Single marital status as reference

# Creating the Model
model_trump <- glm(vote_trump ~ age + gender + state + race + education_level + income_level, 
            data=survey_data, family= "binomial")

# Model Results (to Report in Results section)
# summary(model)
# OR
 
 # Creating the Model
model_biden <- glm(vote_biden ~ age + gender + state + race + education_level + income_level, 
            data=survey_data, family= "binomial")

# Model Results (to Report in Results section)
# summary(model)
# OR
broom::tidy(model_biden)
broom::tidy(model_trump)
```

## Post-Stratification 

In order to estimate the proportion of voters who will vote for Donald Trump I need to perform a post-stratification analysis. Here I create cells based off different ages. Using the model described in the previous sub-section I will estimate the proportion of voters in each age bin. I will then weight each proportion estimate (within each bin) by the respective population size of that bin and sum those values and divide that by the entire population size. 

```{r, include=TRUE}

# Here I will perform the post-stratification calculation
census_data$logodds_estimate <-
  model %>%
  predict(newdata = census_data)

census_data$estimate <-
  exp(census_data$logodds_estimate)/(1+exp(census_data$logodds_estimate))

census_data %>%
  mutate(alp_predict_prop = estimate*n) %>%
  summarise(alp_predict = sum(alp_predict_prop)/sum(n))
  
```
  
  
  
```{r, include=TRUE}

# Here I will perform the post-stratification calculation
# Post-stratification for Trump
census_data$logodds_estimate <-
  model_trump %>%
  predict(newdata = census_data)

census_data$estimate <-
  exp(census_data$logodds_estimate)/(1+exp(census_data$logodds_estimate))

census_data %>%
  mutate(alp_predict_prop = estimate*n) %>% group_by(age) %>%
  summarise(alp_predict = sum(alp_predict_prop)/sum(n),lower = quantile(alp_predict, 0.025),
upper = quantile(alp_predict, 0.975))

# Post-stratification for Biden
census_data$logodds_estimate <-
  model_biden %>%
  predict(newdata = census_data)

census_data$estimate <-
  exp(census_data$logodds_estimate)/(1+exp(census_data$logodds_estimate))

census_data %>%
  mutate(alp_predict_prop = estimate*n) %>% group_by(age) %>%
  summarise(alp_predict = sum(alp_predict_prop)/sum(n),lower = quantile(alp_predict, 0.025),
upper = quantile(alp_predict, 0.975))






```


# Results

Here you will include all results. This includes descriptive statistics, graphs, figures, tables, and model results. Please ensure that everything is well formatted and in a report style. You must also provide an explanation of the results in this section. 

Please ensure that everything is well labelled. So if you have multiple histograms and plots, calling them Figure 1, 2, 3, etc. and referencing them as Figure 1, Figure 2, etc. in your report will be expected. The reader should not get lost in a sea of information. Make sure to have the results be clean, well formatted and digestible.

# Discussion

Here you will summarize the previous sections and discuss conclusions drawn from the results. Make sure to elaborate and connect your analysis to the goal of the study.

## Weaknesses

Here we discuss weaknesses of the study, data, analysis, etc. You can also discuss areas for improvement.

## Next Steps

Here you discuss subsequent work to be done after this report. This can include next steps in terms of statistical analysis (perhaps there is a more efficient algorithm available, or perhaps there is a caveat in the data that would allow for some new technique). Future steps should also be specified in terms of the study setting (eg. including a follow-up survey on something, or a subsequent study that would complement the conclusions of your report).


# References

[1] Tausanovitch, Chris and Lynn Vavreck. 2020. Democracy Fund + UCLA Nationscape, October 10-17, 2019 (version 20200814). Retrieved from https://www.voterstudygroup.org/publication/nationscape-data-set.

[2] Steven Ruggles, Sarah Flood, Ronald Goeken, Josiah Grover, Erin Meyer, Jose Pacas and Matthew Sobek. IPUMS USA: Version 10.0 [dataset]. Minneapolis, MN: IPUMS, 2020. https://doi.org/10.18128/D010.V10.0


